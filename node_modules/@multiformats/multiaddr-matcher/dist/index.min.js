(function (root, factory) {(typeof module === 'object' && module.exports) ? module.exports = factory() : root.MultiformatsMultiaddrMatcher = factory()}(typeof self !== 'undefined' ? self : this, function () {
"use strict";var MultiformatsMultiaddrMatcher=(()=>{var L=Object.defineProperty;var ye=Object.getOwnPropertyDescriptor;var ge=Object.getOwnPropertyNames;var Ae=Object.prototype.hasOwnProperty;var ve=(t,e)=>{for(var r in e)L(t,r,{get:e[r],enumerable:!0})},Ie=(t,e,r,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of ge(e))!Ae.call(t,i)&&i!==r&&L(t,i,{get:()=>e[i],enumerable:!(n=ye(e,i))||n.enumerable});return t};var Pe=t=>Ie(L({},"__esModule",{value:!0}),t);var ot={};ve(ot,{Circuit:()=>Ke,DNS:()=>ze,DNS4:()=>We,DNS6:()=>ke,DNSADDR:()=>Re,HTTP:()=>rt,HTTPS:()=>it,IP:()=>Be,IP4:()=>Ve,IP6:()=>Oe,IP_OR_DOMAIN:()=>Me,P2P:()=>Je,QUIC:()=>Xe,QUICV1:()=>Le,TCP:()=>Ge,UDP:()=>$e,WebRTC:()=>et,WebRTCDirect:()=>je,WebSockets:()=>qe,WebSocketsSecure:()=>He,WebTransport:()=>Fe});var V=class{index=0;input="";new(e){return this.index=0,this.input=e,this}readAtomically(e){let r=this.index,n=e();return n===void 0&&(this.index=r),n}parseWith(e){let r=e();if(this.index===this.input.length)return r}peekChar(){if(!(this.index>=this.input.length))return this.input[this.index]}readChar(){if(!(this.index>=this.input.length))return this.input[this.index++]}readGivenChar(e){return this.readAtomically(()=>{let r=this.readChar();if(r===e)return r})}readSeparator(e,r,n){return this.readAtomically(()=>{if(!(r>0&&this.readGivenChar(e)===void 0))return n()})}readNumber(e,r,n,i){return this.readAtomically(()=>{let o=0,c=0,f=this.peekChar();if(f===void 0)return;let m=f==="0",E=2**(8*i)-1;for(;;){let b=this.readAtomically(()=>{let S=this.readChar();if(S===void 0)return;let D=Number.parseInt(S,e);if(!Number.isNaN(D))return D});if(b===void 0)break;if(o*=e,o+=b,o>E||(c+=1,r!==void 0&&c>r))return}if(c!==0)return!n&&m&&c>1?void 0:o})}readIPv4Addr(){return this.readAtomically(()=>{let e=new Uint8Array(4);for(let r=0;r<e.length;r++){let n=this.readSeparator(".",r,()=>this.readNumber(10,3,!1,1));if(n===void 0)return;e[r]=n}return e})}readIPv6Addr(){let e=r=>{for(let n=0;n<r.length/2;n++){let i=n*2;if(n<r.length-3){let c=this.readSeparator(":",n,()=>this.readIPv4Addr());if(c!==void 0)return r[i]=c[0],r[i+1]=c[1],r[i+2]=c[2],r[i+3]=c[3],[i+4,!0]}let o=this.readSeparator(":",n,()=>this.readNumber(16,4,!0,2));if(o===void 0)return[i,!1];r[i]=o>>8,r[i+1]=o&255}return[r.length,!1]};return this.readAtomically(()=>{let r=new Uint8Array(16),[n,i]=e(r);if(n===16)return r;if(i||this.readGivenChar(":")===void 0||this.readGivenChar(":")===void 0)return;let o=new Uint8Array(14),c=16-(n+2),[f]=e(o.subarray(0,c));return r.set(o.subarray(0,f),16-f),r})}readIPAddr(){return this.readIPv4Addr()??this.readIPv6Addr()}};var Ue=45,_e=15,O=new V;function re(t){if(!(t.length>_e))return O.new(t).parseWith(()=>O.readIPv4Addr())}function ne(t){if(t.includes("%")&&(t=t.split("%")[0]),!(t.length>Ue))return O.new(t).parseWith(()=>O.readIPv6Addr())}function ie(t){return!!re(t)}function oe(t){return!!ne(t)}var pt=new Uint8Array(0);function se(t){if(t instanceof Uint8Array&&t.constructor.name==="Uint8Array")return t;if(t instanceof ArrayBuffer)return new Uint8Array(t);if(ArrayBuffer.isView(t))return new Uint8Array(t.buffer,t.byteOffset,t.byteLength);throw new Error("Unknown type, must be binary type")}function Se(t,e){if(t.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),n=0;n<r.length;n++)r[n]=255;for(var i=0;i<t.length;i++){var o=t.charAt(i),c=o.charCodeAt(0);if(r[c]!==255)throw new TypeError(o+" is ambiguous");r[c]=i}var f=t.length,m=t.charAt(0),E=Math.log(f)/Math.log(256),b=Math.log(256)/Math.log(f);function S(u){if(u instanceof Uint8Array||(ArrayBuffer.isView(u)?u=new Uint8Array(u.buffer,u.byteOffset,u.byteLength):Array.isArray(u)&&(u=Uint8Array.from(u))),!(u instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(u.length===0)return"";for(var x=0,C=0,y=0,A=u.length;y!==A&&u[y]===0;)y++,x++;for(var v=(A-y)*b+1>>>0,w=new Uint8Array(v);y!==A;){for(var I=u[y],_=0,g=v-1;(I!==0||_<C)&&g!==-1;g--,_++)I+=256*w[g]>>>0,w[g]=I%f>>>0,I=I/f>>>0;if(I!==0)throw new Error("Non-zero carry");C=_,y++}for(var P=v-C;P!==v&&w[P]===0;)P++;for(var M=m.repeat(x);P<v;++P)M+=t.charAt(w[P]);return M}function D(u){if(typeof u!="string")throw new TypeError("Expected String");if(u.length===0)return new Uint8Array;var x=0;if(u[x]!==" "){for(var C=0,y=0;u[x]===m;)C++,x++;for(var A=(u.length-x)*E+1>>>0,v=new Uint8Array(A);u[x];){var w=r[u.charCodeAt(x)];if(w===255)return;for(var I=0,_=A-1;(w!==0||I<y)&&_!==-1;_--,I++)w+=f*v[_]>>>0,v[_]=w%256>>>0,w=w/256>>>0;if(w!==0)throw new Error("Non-zero carry");y=I,x++}if(u[x]!==" "){for(var g=A-y;g!==A&&v[g]===0;)g++;for(var P=new Uint8Array(C+(A-g)),M=C;g!==A;)P[M++]=v[g++];return P}}}function we(u){var x=D(u);if(x)return x;throw new Error(`Non-${e} character`)}return{encode:S,decodeUnsafe:D,decode:we}}var Ce=Se,Ne=Ce,ae=Ne;var q=class{name;prefix;baseEncode;constructor(e,r,n){this.name=e,this.prefix=r,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},H=class{name;prefix;baseDecode;prefixCodePoint;constructor(e,r,n){this.name=e,this.prefix=r;let i=r.codePointAt(0);if(i===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=i,this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return ce(this,e)}},j=class{decoders;constructor(e){this.decoders=e}or(e){return ce(this,e)}decode(e){let r=e[0],n=this.decoders[r];if(n!=null)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};function ce(t,e){return new j({...t.decoders??{[t.prefix]:t},...e.decoders??{[e.prefix]:e}})}var F=class{name;prefix;baseEncode;baseDecode;encoder;decoder;constructor(e,r,n,i){this.name=e,this.prefix=r,this.baseEncode=n,this.baseDecode=i,this.encoder=new q(e,r,n),this.decoder=new H(e,r,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};function fe({name:t,prefix:e,encode:r,decode:n}){return new F(t,e,r,n)}function J({name:t,prefix:e,alphabet:r}){let{encode:n,decode:i}=ae(r,t);return fe({prefix:e,name:t,encode:n,decode:o=>se(i(o))})}function Ee(t,e,r,n){let i={};for(let b=0;b<e.length;++b)i[e[b]]=b;let o=t.length;for(;t[o-1]==="=";)--o;let c=new Uint8Array(o*r/8|0),f=0,m=0,E=0;for(let b=0;b<o;++b){let S=i[t[b]];if(S===void 0)throw new SyntaxError(`Non-${n} character`);m=m<<r|S,f+=r,f>=8&&(f-=8,c[E++]=255&m>>f)}if(f>=r||255&m<<8-f)throw new SyntaxError("Unexpected end of data");return c}function De(t,e,r){let n=e[e.length-1]==="=",i=(1<<r)-1,o="",c=0,f=0;for(let m=0;m<t.length;++m)for(f=f<<8|t[m],c+=8;c>r;)c-=r,o+=e[i&f>>c];if(c!==0&&(o+=e[i&f<<r-c]),n)for(;o.length*r&7;)o+="=";return o}function T({name:t,prefix:e,bitsPerChar:r,alphabet:n}){return fe({prefix:e,name:t,encode(i){return De(i,n,r)},decode(i){return Ee(i,n,r,t)}})}var de=J({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),gt=J({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var It=T({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),Pt=T({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),ue=T({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),Ut=T({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var Te=t=>t.toString().split("/").slice(1),N=t=>({match:e=>e.length<1?!1:t(e[0])?e.slice(1):!1,pattern:"fn"}),s=t=>({match:e=>N(r=>r===t).match(e),pattern:t}),W=()=>({match:t=>N(e=>typeof e=="string").match(t),pattern:"{string}"}),k=()=>({match:t=>N(e=>!isNaN(parseInt(e))).match(t),pattern:"{number}"}),h=()=>({match:t=>{if(t.length<2||t[0]!=="p2p"&&t[0]!=="ipfs")return!1;if(t[1].startsWith("Q")||t[1].startsWith("1"))try{de.decode(`z${t[1]}`)}catch{return!1}else return!1;return t.slice(2)},pattern:"/p2p/{peerid}"}),R=()=>({match:t=>{if(t.length<2||t[0]!=="certhash")return!1;try{ue.decode(t[1])}catch{return!1}return t.slice(2)},pattern:"/certhash/{certhash}"}),d=t=>({match:e=>{let r=t.match(e);return r===!1?e:r},pattern:`optional(${t.pattern})`}),l=(...t)=>({match:e=>{let r;for(let n of t){let i=n.match(e);i!==!1&&(r==null||i.length<r.length)&&(r=i)}return r??!1},pattern:`or(${t.map(e=>e.pattern).join(", ")})`}),a=(...t)=>({match:e=>{for(let r of t){let n=r.match(e);if(n===!1)return!1;e=n}return e},pattern:`and(${t.map(e=>e.pattern).join(", ")})`});function p(...t){function e(i){let o=Te(i);for(let c of t){let f=c.match(o);if(f===!1)return!1;o=f}return o}function r(i){return e(i)!==!1}function n(i){let o=e(i);return o===!1?!1:o.length===0}return{matchers:t,matches:r,exactMatch:n}}var G=a(s("dns4"),W()),$=a(s("dns6"),W()),Q=a(s("dnsaddr"),W()),K=a(s("dns"),W()),We=p(G,d(h())),ke=p($,d(h())),Re=p(Q,d(h())),ze=p(l(K,Q,G,$),d(h())),he=a(s("ip4"),N(ie)),pe=a(s("ip6"),N(oe)),Y=l(he,pe),U=l(Y,K,G,$,Q),Me=p(l(Y,a(l(K,Q,G,$),d(h())))),Ve=p(he),Oe=p(pe),Be=p(Y),ee=a(U,s("tcp"),k()),z=a(U,s("udp"),k()),Ge=p(a(ee,d(h()))),$e=p(z),te=a(z,s("quic")),X=a(z,s("quic-v1")),Qe=l(te,X),Xe=p(te),Le=p(X),Z=l(U,ee,z,te,X),le=l(a(Z,s("ws"),d(h()))),qe=p(le),xe=l(a(Z,s("wss"),d(h())),a(Z,s("tls"),s("ws"),d(h()))),He=p(xe),me=a(z,s("webrtc-direct"),d(R()),d(R()),d(h())),je=p(me),be=a(X,s("webtransport"),d(R()),d(R()),d(h())),Fe=p(be),B=l(le,xe,a(ee,d(h())),a(Qe,d(h())),a(U,d(h())),me,be,h()),Je=p(B),Ze=a(B,s("p2p-circuit"),h()),Ke=p(Ze),Ye=l(a(B,s("p2p-circuit"),s("webrtc"),d(h())),a(B,s("webrtc"),d(h())),s("webrtc")),et=p(Ye),tt=l(a(U,s("tcp"),k(),s("http"),d(h())),a(U,s("http"),d(h()))),rt=p(tt),nt=l(a(U,s("tcp"),l(a(s("443"),s("http")),a(k(),s("https"))),d(h())),a(U,s("tls"),s("http"),d(h())),a(U,s("https"),d(h()))),it=p(nt);return Pe(ot);})();
return MultiformatsMultiaddrMatcher}));
